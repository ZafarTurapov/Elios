name: PR Auto-Sync (Octokit)
on:
  schedule: [{ cron: "0 * * * *" }]
  workflow_dispatch: {}
permissions:
  contents: write
  pull-requests: write
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: List & Update PRs with Octokit
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const {owner, repo} = context.repo;
            const prs = await github.paginate(github.rest.pulls.list, {owner, repo, state:'open', per_page:100});
            let updated = 0;
            for (const pr of prs) {
              try {
                await github.request('PUT /repos/{owner}/{repo}/pulls/{pull_number}/update-branch', {
                  owner, repo, pull_number: pr.number
                });
                core.info(`Updated PR #${pr.number} (${pr.head.ref} â†’ ${pr.base.ref})`);
                updated++;
              } catch (e) {
                core.info(`Skip PR #${pr.number}: ${e.status || 'err'} ${e.message}`);
              }
            }
            core.summary.addRaw(`Updated: ${updated} PR(s)`).write();
